<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherWise - Smart Weather App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes slideRight {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes rain {
            0% { background-position: 0 0; }
            100% { background-position: 5px 10px; }
        }
        
        @keyframes snow {
            0% { transform: translateY(-10px) rotate(0deg); }
            100% { transform: translateY(calc(100vh + 10px)) rotate(360deg); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        .animate-slide-up {
            animation: slideUp 0.5s ease-out forwards;
        }
        
        .animate-slide-right {
            animation: slideRight 0.5s ease-out forwards;
        }
        
        .animate-pulse {
            animation: pulse 2s infinite;
        }
        
        .animate-rotate {
            animation: rotate 20s linear infinite;
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        .rain-effect {
            background-image: linear-gradient(transparent, rgba(255,255,255,0.3));
            background-size: 5px 10px;
            animation: rain 0.5s linear infinite;
        }
        
        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            animation: snow linear forwards;
        }
        
        .animate-gradient-flow {
            background-size: 400% 400%;
            animation: gradientFlow 15s ease infinite;
        }
        
        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .theme-transition {
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        
        .temp-counter {
            transition: all 0.5s ease-out;
        }
        
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .search-container {
            transition: all 0.3s ease;
        }
        
        .search-container.focused {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Weather theme colors */
        .theme-sunny {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            color: #4a2511;
        }
        
        .theme-rainy {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: #e0e7ff;
        }
        
        .theme-cloudy {
            background: linear-gradient(135deg, #bdc3c7 0%, #2c3e50 100%);
            color: #1f2937;
        }
        
        .theme-snowy {
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            color: #0d47a1;
        }
        
        .theme-night {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #e0e7ff;
        }
        
        .theme-default {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
        }
        
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .forecast-container {
                grid-auto-columns: 120px;
            }
            
            .main-card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col theme-default theme-transition font-sans">
    <!-- Background effects container -->
    <div id="weather-effects" class="fixed inset-0 pointer-events-none z-0">
        <div class="absolute inset-0 bg-gradient-to-br from-blue-400 to-purple-600 animate-gradient-flow"></div>
    </div>
    
    <!-- Main content -->
    <div class="flex-1 flex flex-col z-10">
        <!-- Header -->
        <header class="py-4 px-6 animate-slide-up" style="animation-delay: 0.1s;">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold">WeatherWise</h1>
                <div class="text-sm opacity-80" id="current-date"></div>
            </div>
        </header>
        
        <!-- Search section -->
        <section class="px-6 mb-6 animate-slide-up" style="animation-delay: 0.2s;">
            <div class="container mx-auto">
                <div class="search-container bg-white bg-opacity-20 rounded-full p-1 flex items-center max-w-md mx-auto backdrop-blur-sm border border-white border-opacity-30">
                    <input type="text" id="city-search" placeholder="Search city..." 
                           class="flex-1 bg-transparent border-none outline-none px-4 py-2 placeholder-white placeholder-opacity-70 text-white">
                    <button id="location-btn" class="w-10 h-10 rounded-full bg-white bg-opacity-20 flex items-center justify-center text-white hover:bg-opacity-30 transition-all duration-300" aria-label="Use current location">
                        <i class="fas fa-location-arrow"></i>
                    </button>
                </div>
                <div id="search-suggestions" class="hidden mt-2 bg-white bg-opacity-90 rounded-lg shadow-lg max-w-md mx-auto max-h-60 overflow-y-auto"></div>
            </div>
        </section>
        
        <!-- Main weather card -->
        <main class="flex-1 px-6 animate-slide-up" style="animation-delay: 0.3s;">
            <div class="container mx-auto">
                <div id="main-card" class="main-card bg-white bg-opacity-20 rounded-2xl p-6 mb-6 backdrop-blur-sm border border-white border-opacity-20 shadow-lg transition-all duration-500">
                    <!-- Skeleton loading -->
                    <div id="loading-skeleton" class="space-y-4">
                        <div class="skeleton h-12 w-3/4 mx-auto rounded-lg"></div>
                        <div class="skeleton h-8 w-1/2 mx-auto rounded-lg"></div>
                        <div class="skeleton h-6 w-1/3 mx-auto rounded-lg"></div>
                        <div class="grid grid-cols-3 gap-4 mt-8">
                            <div class="skeleton h-16 rounded-lg"></div>
                            <div class="skeleton h-16 rounded-lg"></div>
                            <div class="skeleton h-16 rounded-lg"></div>
                        </div>
                    </div>
                    
                    <!-- Actual content (hidden by default) -->
                    <div id="weather-content" class="hidden">
                        <div class="text-center">
                            <div id="weather-icon" class="text-8xl mb-4 mx-auto"></div>
                            <div class="flex justify-center items-end">
                                <div id="current-temp" class="text-7xl font-bold temp-counter">--</div>
                                <div id="temp-unit" class="text-4xl opacity-80 mb-2">Â°C</div>
                            </div>
                            <div id="weather-condition" class="text-2xl font-medium mt-2">--</div>
                            <div id="location" class="text-xl opacity-90 mt-1 flex items-center justify-center">
                                <i class="fas fa-map-marker-alt mr-2"></i>
                                <span>--</span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mt-8">
                            <div class="bg-white bg-opacity-20 rounded-lg p-3 text-center">
                                <div class="text-sm opacity-80">Humidity</div>
                                <div id="humidity" class="text-2xl font-medium">--%</div>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-lg p-3 text-center">
                                <div class="text-sm opacity-80">Wind</div>
                                <div id="wind" class="text-2xl font-medium">-- km/h</div>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-lg p-3 text-center">
                                <div class="text-sm opacity-80">Feels Like</div>
                                <div id="feels-like" class="text-2xl font-medium">--Â°</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Weather insights -->
                <div id="weather-insights" class="bg-white bg-opacity-20 rounded-2xl p-4 mb-6 backdrop-blur-sm border border-white border-opacity-20 animate-slide-up hidden" style="animation-delay: 0.4s;">
                    <div class="flex items-start">
                        <i class="fas fa-lightbulb text-xl mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-medium mb-1">Today's Weather Insight</h3>
                            <p id="insight-text" class="opacity-90 text-sm">Loading weather insights...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Forecast section -->
                <div class="animate-slide-up" style="animation-delay: 0.5s;">
                    <h2 class="text-xl font-semibold mb-4">5-Day Forecast</h2>
                    <div id="forecast-container" class="grid grid-flow-col auto-cols-fr gap-4 overflow-x-auto pb-4 forecast-container">
                        <!-- Forecast cards will be added here by JavaScript -->
                        <div class="skeleton h-40 rounded-xl"></div>
                        <div class="skeleton h-40 rounded-xl"></div>
                        <div class="skeleton h-40 rounded-xl"></div>
                        <div class="skeleton h-40 rounded-xl"></div>
                        <div class="skeleton h-40 rounded-xl"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Footer -->
    <footer class="py-4 px-6 text-center text-sm opacity-80 animate-slide-up" style="animation-delay: 0.6s;">
        <div class="container mx-auto">
            <p>Powered by OpenWeatherMap API</p>
            <p class="mt-1">WeatherWise Â© 2023 - Smart weather insights</p>
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // API configuration
            const WeatherApp = {
                config: {
                    apiKey: 'YOUR_API_KEY_HERE', // Replace with your actual API key
                    baseUrl: 'https://api.openweathermap.org/data/2.5',
                    units: 'metric'
                },
                
                elements: {
                    citySearch: document.getElementById('city-search'),
                    locationBtn: document.getElementById('location-btn'),
                    searchSuggestions: document.getElementById('search-suggestions'),
                    currentDate: document.getElementById('current-date'),
                    loadingSkeleton: document.getElementById('loading-skeleton'),
                    weatherContent: document.getElementById('weather-content'),
                    weatherIcon: document.getElementById('weather-icon'),
                    currentTemp: document.getElementById('current-temp'),
                    tempUnit: document.getElementById('temp-unit'),
                    weatherCondition: document.getElementById('weather-condition'),
                    location: document.getElementById('location'),
                    humidity: document.getElementById('humidity'),
                    wind: document.getElementById('wind'),
                    feelsLike: document.getElementById('feels-like'),
                    mainCard: document.getElementById('main-card'),
                    weatherInsights: document.getElementById('weather-insights'),
                    insightText: document.getElementById('insight-text'),
                    forecastContainer: document.getElementById('forecast-container'),
                    weatherEffects: document.getElementById('weather-effects'),
                    body: document.body
                },
                
                state: {
                    currentWeather: null,
                    forecast: null,
                    lastSearched: null,
                    debounceTimer: null
                },
                
                init: function() {
                    // Set current date
                    this.updateCurrentDate();
                    
                    // Load last searched location or get current location
                    this.loadLastLocation();
                    
                    // Set up event listeners
                    this.setupEventListeners();
                },
                
                setupEventListeners: function() {
                    // Location button click
                    this.elements.locationBtn.addEventListener('click', () => {
                        this.getUserLocation();
                    });
                    
                    // City search input
                    this.elements.citySearch.addEventListener('input', (e) => {
                        this.handleSearchInput(e.target.value);
                    });
                    
                    // Search input focus/blur
                    this.elements.citySearch.addEventListener('focus', () => {
                        this.elements.citySearch.parentElement.classList.add('focused');
                    });
                    
                    this.elements.citySearch.addEventListener('blur', () => {
                        setTimeout(() => {
                            this.elements.citySearch.parentElement.classList.remove('focused');
                            this.elements.searchSuggestions.classList.add('hidden');
                        }, 200);
                    });
                    
                    // Click outside suggestions
                    document.addEventListener('click', (e) => {
                        if (!this.elements.searchSuggestions.contains(e.target) && 
                            !this.elements.citySearch.contains(e.target)) {
                            this.elements.searchSuggestions.classList.add('hidden');
                        }
                    });
                },
                
                updateCurrentDate: function() {
                    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    const now = new Date();
                    this.elements.currentDate.textContent = now.toLocaleDateString('en-US', options);
                },
                
                loadLastLocation: function() {
                    const lastLocation = localStorage.getItem('lastLocation');
                    if (lastLocation) {
                        this.state.lastSearched = JSON.parse(lastLocation);
                        this.elements.citySearch.value = this.state.lastSearched.name;
                        this.getWeatherByCoords(this.state.lastSearched.lat, this.state.lastSearched.lon);
                    } else {
                        this.getUserLocation();
                    }
                },
                
                getUserLocation: function() {
                    this.showLoadingState();
                    
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                const { latitude, longitude } = position.coords;
                                this.getWeatherByCoords(latitude, longitude);
                            },
                            (error) => {
                                console.error("Error getting location:", error);
                                this.showErrorState("Location access denied. Please search for a city.");
                                
                                // Fallback to a default city
                                this.getWeatherByCity('London');
                            }
                        );
                    } else {
                        this.showErrorState("Geolocation is not supported by your browser. Please search for a city.");
                        this.getWeatherByCity('London');
                    }
                },
                
                handleSearchInput: function(query) {
                    if (query.length < 2) {
                        this.elements.searchSuggestions.classList.add('hidden');
                        return;
                    }
                    
                    clearTimeout(this.state.debounceTimer);
                    
                    this.state.debounceTimer = setTimeout(() => {
                        this.searchCities(query);
                    }, 300);
                },
                
                searchCities: async function(query) {
                    try {
                        const response = await fetch(`${this.config.baseUrl}/find?q=${query}&appid=${this.config.apiKey}&units=${this.config.units}`);
                        const data = await response.json();
                        
                        if (data.list && data.list.length > 0) {
                            this.showSearchSuggestions(data.list);
                        } else {
                            this.elements.searchSuggestions.classList.add('hidden');
                        }
                    } catch (error) {
                        console.error("Error searching cities:", error);
                        this.elements.searchSuggestions.classList.add('hidden');
                    }
                },
                
                showSearchSuggestions: function(cities) {
                    this.elements.searchSuggestions.innerHTML = '';
                    this.elements.searchSuggestions.classList.remove('hidden');
                    
                    // Limit to 5 suggestions
                    const limitedCities = cities.slice(0, 5);
                    
                    limitedCities.forEach(city => {
                        const suggestion = document.createElement('div');
                        suggestion.className = 'px-4 py-2 hover:bg-gray-100 cursor-pointer transition-colors';
                        suggestion.textContent = `${city.name}, ${city.sys.country}`;
                        
                        suggestion.addEventListener('click', () => {
                            this.elements.citySearch.value = `${city.name}, ${city.sys.country}`;
                            this.elements.searchSuggestions.classList.add('hidden');
                            this.getWeatherByCoords(city.coord.lat, city.coord.lon);
                        });
                        
                        this.elements.searchSuggestions.appendChild(suggestion);
                    });
                },
                
                getWeatherByCoords: async function(lat, lon) {
                    this.showLoadingState();
                    
                    try {
                        // Get current weather
                        const currentResponse = await fetch(`${this.config.baseUrl}/weather?lat=${lat}&lon=${lon}&appid=${this.config.apiKey}&units=${this.config.units}`);
                        const currentData = await currentResponse.json();
                        
                        if (currentData.cod !== 200) {
                            throw new Error(currentData.message || 'Failed to fetch weather data');
                        }
                        
                        // Get forecast
                        const forecastResponse = await fetch(`${this.config.baseUrl}/forecast?lat=${lat}&lon=${lon}&appid=${this.config.apiKey}&units=${this.config.units}`);
                        const forecastData = await forecastResponse.json();
                        
                        if (forecastData.cod !== '200') {
                            throw new Error(forecastData.message || 'Failed to fetch forecast data');
                        }
                        
                        // Save to state
                        this.state.currentWeather = currentData;
                        this.state.forecast = forecastData;
                        
                        // Save as last searched
                        this.state.lastSearched = {
                            name: `${currentData.name}, ${currentData.sys.country}`,
                            lat: lat,
                            lon: lon
                        };
                        localStorage.setItem('lastLocation', JSON.stringify(this.state.lastSearched));
                        
                        // Update UI
                        this.updateUI();
                    } catch (error) {
                        console.error("Error fetching weather data:", error);
                        this.showErrorState(error.message || "Failed to load weather data. Please try again.");
                    }
                },
                
                getWeatherByCity: async function(city) {
                    try {
                        const response = await fetch(`${this.config.baseUrl}/weather?q=${city}&appid=${this.config.apiKey}&units=${this.config.units}`);
                        const data = await response.json();
                        
                        if (data.cod !== 200) {
                            throw new Error(data.message || 'Failed to fetch weather data');
                        }
                        
                        this.getWeatherByCoords(data.coord.lat, data.coord.lon);
                    } catch (error) {
                        console.error("Error fetching weather by city:", error);
                        this.showErrorState(error.message || "City not found. Please try another location.");
                    }
                },
                
                updateUI: function() {
                    // Hide loading skeleton
                    this.elements.loadingSkeleton.classList.add('hidden');
                    this.elements.weatherContent.classList.remove('hidden');
                    this.elements.weatherInsights.classList.remove('hidden');
                    
                    // Update current weather
                    const weather = this.state.currentWeather;
                    const temp = Math.round(weather.main.temp);
                    const feelsLike = Math.round(weather.main.feels_like);
                    
                    // Animate temperature counter
                    this.animateCounter(this.elements.currentTemp, temp);
                    
                    this.elements.weatherCondition.textContent = weather.weather[0].main;
                    this.elements.location.querySelector('span').textContent = `${weather.name}, ${weather.sys.country}`;
                    this.elements.humidity.textContent = `${weather.main.humidity}%`;
                    this.elements.wind.textContent = `${Math.round(weather.wind.speed * 3.6)} km/h`;
                    this.elements.feelsLike.textContent = `${feelsLike}Â°`;
                    
                    // Update weather icon
                    this.setWeatherIcon(weather.weather[0].id, weather.weather[0].icon);
                    
                    // Update theme based on weather
                    this.setTheme(weather.weather[0].id, weather.sys.sunset);
                    
                    // Update weather insights
                    this.updateWeatherInsights(weather);
                    
                    // Update forecast
                    this.updateForecast();
                    
                    // Add weather effects
                    this.addWeatherEffects(weather.weather[0].id);
                },
                
                animateCounter: function(element, targetValue) {
                    const duration = 1000; // 1 second
                    const startValue = parseInt(element.textContent) || 0;
                    const startTime = performance.now();
                    
                    function updateCounter(currentTime) {
                        const elapsedTime = currentTime - startTime;
                        const progress = Math.min(elapsedTime / duration, 1);
                        const currentValue = Math.floor(startValue + (targetValue - startValue) * progress);
                        
                        element.textContent = currentValue;
                        
                        if (progress < 1) {
                            requestAnimationFrame(updateCounter);
                        }
                    }
                    
                    requestAnimationFrame(updateCounter);
                },
                
                setWeatherIcon: function(weatherCode, iconCode) {
                    const iconElement = this.elements.weatherIcon;
                    iconElement.innerHTML = '';
                    
                    // Determine if it's day or night (iconCode ends with 'd' or 'n')
                    const isDay = iconCode.endsWith('d');
                    
                    // Map weather codes to icons
                    let iconClass = 'fas fa-question';
                    
                    // Thunderstorm
                    if (weatherCode >= 200 && weatherCode < 300) {
                        iconClass = 'fas fa-bolt';
                    } 
                    // Drizzle
                    else if (weatherCode >= 300 && weatherCode < 400) {
                        iconClass = 'fas fa-cloud-rain';
                    } 
                    // Rain
                    else if (weatherCode >= 500 && weatherCode < 600) {
                        iconClass = 'fas fa-umbrella';
                    } 
                    // Snow
                    else if (weatherCode >= 600 && weatherCode < 700) {
                        iconClass = 'far fa-snowflake';
                    } 
                    // Atmosphere (fog, mist, etc.)
                    else if (weatherCode >= 700 && weatherCode < 800) {
                        iconClass = 'fas fa-smog';
                    } 
                    // Clear
                    else if (weatherCode === 800) {
                        iconClass = isDay ? 'fas fa-sun' : 'fas fa-moon';
                    } 
                    // Clouds
                    else if (weatherCode > 800 && weatherCode < 900) {
                        if (weatherCode === 801) {
                            iconClass = isDay ? 'fas fa-cloud-sun' : 'fas fa-cloud-moon';
                        } else {
                            iconClass = 'fas fa-cloud';
                        }
                    }
                    
                    const icon = document.createElement('i');
                    icon.className = `${iconClass} text-8xl`;
                    
                    // Add animation based on weather
                    if (weatherCode === 800 && isDay) {
                        icon.classList.add('animate-rotate');
                    } else if (weatherCode >= 500 && weatherCode < 600) {
                        icon.classList.add('animate-pulse');
                    } else if (weatherCode >= 200 && weatherCode < 300) {
                        icon.classList.add('animate-pulse');
                    } else if (weatherCode >= 600 && weatherCode < 700) {
                        icon.classList.add('animate-float');
                    }
                    
                    iconElement.appendChild(icon);
                },
                
                setTheme: function(weatherCode, sunsetTime) {
                    const now = Math.floor(Date.now() / 1000);
                    const isNight = sunsetTime && now > sunsetTime;
                    
                    // Remove all theme classes
                    this.elements.body.classList.remove(
                        'theme-sunny', 'theme-rainy', 'theme-cloudy', 
                        'theme-snowy', 'theme-night', 'theme-default'
                    );
                    
                    // Thunderstorm
                    if (weatherCode >= 200 && weatherCode < 300) {
                        this.elements.body.classList.add('theme-rainy');
                    } 
                    // Drizzle or Rain
                    else if (weatherCode >= 300 && weatherCode < 600) {
                        this.elements.body.classList.add('theme-rainy');
                    } 
                    // Snow
                    else if (weatherCode >= 600 && weatherCode < 700) {
                        this.elements.body.classList.add('theme-snowy');
                    } 
                    // Atmosphere (fog, mist, etc.)
                    else if (weatherCode >= 700 && weatherCode < 800) {
                        this.elements.body.classList.add('theme-cloudy');
                    } 
                    // Clear
                    else if (weatherCode === 800) {
                        if (isNight) {
                            this.elements.body.classList.add('theme-night');
                        } else {
                            this.elements.body.classList.add('theme-sunny');
                        }
                    } 
                    // Clouds
                    else if (weatherCode > 800 && weatherCode < 900) {
                        this.elements.body.classList.add('theme-cloudy');
                    } else {
                        this.elements.body.classList.add('theme-default');
                    }
                },
                
                updateWeatherInsights: function(weatherData) {
                    const temp = weatherData.main.temp;
                    const condition = weatherData.weather[0].main.toLowerCase();
                    const windSpeed = weatherData.wind.speed;
                    const humidity = weatherData.main.humidity;
                    
                    let insight = '';
                    
                    // Temperature-based insights
                    if (temp > 30) {
                        insight = "Very hot today! Stay hydrated and avoid prolonged sun exposure.";
                    } else if (temp > 20) {
                        insight = "Pleasantly warm. Perfect for outdoor activities!";
                    } else if (temp > 10) {
                        insight = "Mild weather. A light jacket might be comfortable.";
                    } else if (temp > 0) {
                        insight = "Chilly today. Bundle up with a warm jacket.";
                    } else {
                        insight = "Freezing cold! Wear multiple layers and limit time outdoors.";
                    }
                    
                    // Condition-based additions
                    if (condition.includes('rain')) {
                        insight += " Don't forget your umbrella!";
                    } else if (condition.includes('snow')) {
                        insight += " Watch for slippery surfaces.";
                    } else if (condition.includes('thunderstorm')) {
                        insight += " Stay indoors if possible.";
                    } else if (condition.includes('clear') && temp > 25) {
                        insight += " Apply sunscreen to protect your skin.";
                    }
                    
                    // Wind additions
                    if (windSpeed > 8) {
                        insight += " Windy conditions - secure loose items.";
                    }
                    
                    // Humidity additions
                    if (humidity > 80) {
                        insight += " High humidity making it feel warmer.";
                    } else if (humidity < 30) {
                        insight += " Low humidity - stay hydrated.";
                    }
                    
                    this.elements.insightText.textContent = insight;
                },
                
                updateForecast: function() {
                    const forecastData = this.state.forecast;
                    this.elements.forecastContainer.innerHTML = '';
                    
                    // Group forecast by day
                    const dailyForecast = {};
                    const now = new Date();
                    const today = now.getDate();
                    
                    forecastData.list.forEach(item => {
                        const date = new Date(item.dt * 1000);
                        const day = date.getDate();
                        
                        // Skip if it's today or if we already have data for this day
                        if (day === today || (dailyForecast[day] && dailyForecast[day].length >= 2)) {
                            return;
                        }
                        
                        if (!dailyForecast[day]) {
                            dailyForecast[day] = [];
                        }
                        
                        dailyForecast[day].push(item);
                    });
                    
                    // Create forecast cards for next 5 days
                    const days = Object.keys(dailyForecast).slice(0, 5);
                    
                    days.forEach((day, index) => {
                        const dayForecast = dailyForecast[day];
                        const firstForecast = dayForecast[0];
                        const date = new Date(firstForecast.dt * 1000);
                        
                        // Get min/max temps for the day
                        let minTemp = firstForecast.main.temp_min;
                        let maxTemp = firstForecast.main.temp_max;
                        
                        dayForecast.forEach(item => {
                            minTemp = Math.min(minTemp, item.main.temp_min);
                            maxTemp = Math.max(maxTemp, item.main.temp_max);
                        });
                        
                        // Create card
                        const card = document.createElement('div');
                        card.className = 'bg-white bg-opacity-20 rounded-xl p-4 flex flex-col items-center justify-between card-hover backdrop-blur-sm border border-white border-opacity-20';
                        card.style.animationDelay = `${0.6 + index * 0.1}s`;
                        card.classList.add('animate-slide-right');
                        
                        // Day name
                        const dayName = document.createElement('div');
                        dayName.className = 'font-medium';
                        
                        if (index === 0) {
                            dayName.textContent = 'Tomorrow';
                        } else {
                            dayName.textContent = date.toLocaleDateString('en-US', { weekday: 'short' });
                        }
                        
                        // Weather icon
                        const icon = document.createElement('div');
                        icon.className = 'text-4xl my-2';
                        
                        const weatherIcon = document.createElement('i');
                        const isDay = firstForecast.weather[0].icon.endsWith('d');
                        
                        // Simplified icon selection for forecast
                        if (firstForecast.weather[0].id >= 200 && firstForecast.weather[0].id < 300) {
                            weatherIcon.className = 'fas fa-bolt';
                        } else if (firstForecast.weather[0].id >= 300 && firstForecast.weather[0].id < 600) {
                            weatherIcon.className = 'fas fa-cloud-rain';
                        } else if (firstForecast.weather[0].id >= 600 && firstForecast.weather[0].id < 700) {
                            weatherIcon.className = 'far fa-snowflake';
                        } else if (firstForecast.weather[0].id === 800) {
                            weatherIcon.className = isDay ? 'fas fa-sun' : 'fas fa-moon';
                        } else {
                            weatherIcon.className = 'fas fa-cloud';
                        }
                        
                        icon.appendChild(weatherIcon);
                        
                        // Temperatures
                        const temps = document.createElement('div');
                        temps.className = 'flex justify-between w-full';
                        
                        const maxTempElement = document.createElement('span');
                        maxTempElement.className = 'font-semibold';
                        maxTempElement.textContent = `${Math.round(maxTemp)}Â°`;
                        
                        const minTempElement = document.createElement('span');
                        minTempElement.className = 'opacity-70';
                        minTempElement.textContent = `${Math.round(minTemp)}Â°`;
                        
                        temps.appendChild(maxTempElement);
                        temps.appendChild(minTempElement);
                        
                        // Weather description
                        const desc = document.createElement('div');
                        desc.className = 'text-sm opacity-90 mt-1 text-center';
                        desc.textContent = firstForecast.weather[0].main;
                        
                        // Assemble card
                        card.appendChild(dayName);
                        card.appendChild(icon);
                        card.appendChild(temps);
                        card.appendChild(desc);
                        
                        this.elements.forecastContainer.appendChild(card);
                    });
                },
                
                addWeatherEffects: function(weatherCode) {
                    this.elements.weatherEffects.innerHTML = '';
                    const bgElement = document.createElement('div');
                    bgElement.className = 'absolute inset-0 animate-gradient-flow';
                    
                    // Set different gradient backgrounds based on weather
                    if (weatherCode >= 200 && weatherCode < 300) { // Thunderstorm
                        bgElement.classList.add('bg-gradient-to-br', 'from-gray-700', 'to-gray-900');
                    } else if (weatherCode >= 300 && weatherCode < 600) { // Rain/Drizzle
                        bgElement.classList.add('bg-gradient-to-br', 'from-blue-600', 'to-blue-900');
                    } else if (weatherCode >= 600 && weatherCode < 700) { // Snow
                        bgElement.classList.add('bg-gradient-to-br', 'from-blue-100', 'to-blue-300');
                        this.createSnowflakes();
                    } else if (weatherCode === 800) { // Clear
                        const isDay = new Date().getHours() > 6 && new Date().getHours() < 20;
                        if (isDay) {
                            bgElement.classList.add('bg-gradient-to-br', 'from-blue-400', 'to-purple-600');
                        } else {
                            bgElement.classList.add('bg-gradient-to-br', 'from-blue-900', 'to-purple-900');
                        }
                    } else { // Clouds/other
                        bgElement.classList.add('bg-gradient-to-br', 'from-gray-400', 'to-gray-600');
                    }
                    
                    this.elements.weatherEffects.appendChild(bgElement);
                    
                    // Rain effect
                    if (weatherCode >= 500 && weatherCode < 600) {
                        this.elements.weatherEffects.classList.add('rain-effect');
                    } else {
                        this.elements.weatherEffects.classList.remove('rain-effect');
                    }
                },
                
                createSnowflakes: function() {
                    const snowflakeCount = 50;
                    
                    for (let i = 0; i < snowflakeCount; i++) {
                        const snowflake = document.createElement('div');
                        snowflake.classList.add('snowflake');
                        
                        // Random size between 2px and 8px
                        const size = Math.random() * 6 + 2;
                        snowflake.style.width = `${size}px`;
                        snowflake.style.height = `${size}px`;
                        
                        // Random opacity
                        snowflake.style.opacity = Math.random() * 0.7 + 0.3;
                        
                        // Random starting position
                        snowflake.style.left = `${Math.random() * 100}vw`;
                        
                        // Random animation duration (5-15s)
                        const duration = Math.random() * 10 + 5;
                        snowflake.style.animationDuration = `${duration}s`;
                        
                        // Random delay
                        snowflake.style.animationDelay = `${Math.random() * 5}s`;
                        
                        this.elements.weatherEffects.appendChild(snowflake);
                    }
                },
                
                showLoadingState: function() {
                    this.elements.loadingSkeleton.classList.remove('hidden');
                    this.elements.weatherContent.classList.add('hidden');
                    this.elements.weatherInsights.classList.add('hidden');
                    
                    // Show loading animation on location button
                    this.elements.locationBtn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i>';
                },
                
                showErrorState: function(message) {
                    this.elements.loadingSkeleton.classList.add('hidden');
                    this.elements.weatherContent.classList.add('hidden');
                    
                    // Reset location button
                    this.elements.locationBtn.innerHTML = '<i class="fas fa-location-arrow"></i>';
                    
                    // Show error message
                    const errorElement = document.createElement('div');
                    errorElement.className = 'text-center py-8';
                    errorElement.innerHTML = `
                        <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                        <p class="text-lg">${message}</p>
                        <button class="mt-4 px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-colors">
                            Try Again
                        </button>
                    `;
                    
                    // Replace main card content
                    this.elements.mainCard.innerHTML = '';
                    this.elements.mainCard.appendChild(errorElement);
                    
                    // Add event listener to try again button
                    const tryAgainBtn = errorElement.querySelector('button');
                    tryAgainBtn.addEventListener('click', () => {
                        this.getUserLocation();
                    });
                }
            };
            
            // Initialize the app
            WeatherApp.init();
        });
    </script>
</body>
</html>